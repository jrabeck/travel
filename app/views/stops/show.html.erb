
<div class="main-wrapper">


  <!-- PAGE TITLE -->
  <section class="pageTitle" style="background-image:url(/img/pages/page-title-bg3.jpg);">
    <div class="container">
      <div class="row">
        <div class="col-xs-12">
          <div class="titleTable">
            <div class="titleTableInner">
              <div class="pageTitleInfo">
                <h1><%= @stop.name %></h1>
                <div class="under-border"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- PAGE CONTENT -->
  <section class="mainContentSection singlePackage">
    <div class="container">
      <div class="row ">
        <% if @stop.images.length > 0 %>
        <div class="row galleryCarousel">
          <div class="col-sm-8 col-xs-12">
            <div id="package-carousel" class="carousel slide" data-ride="carousel" data-interval="false">


              <div class="carousel-inner stops-carousel">
                <div class="item active stops-carousel">
                  <img alt="slide" class="stops-carousel carousel_width" src="<%=@stop.images.first.url%>">
                </div>
                <% counter = 0 %>
                <% @stop.images.each do |image| %>
                <% if counter != 0 %>
                <div class="item stops-carousel">
                  <img alt="Slide" src="<%=image.url%>" class="stops-carousel">
                </div>
                <% end %>
                <% counter = counter + 1 %>
                <% end %>
              </div>
              <a class="left carousel-control" href="/#package-carousel" data-slide="prev"><span class="glyphicon glyphicon-menu-left"></span></a>
              <a class="right carousel-control" href="/#package-carousel" data-slide="next"><span class="glyphicon glyphicon-menu-right"></span></a>
            </div>
          </div>
          <div class="col-sm-4 col-xs-12">
            <aside>
              <div class="weatherInfo">
                <div class="cityWeather ">
                  <% if @stop.latitude %>
                  <div class="mapdiv">
                    <div class="smallmap"> 
                      <div id="map">
                      </div> 
                    </div>
                  </div>
                  <% end %>
                </div> <!-- cityWeather -->
              </div> <!-- weather info -->
            </aside> <!-- weather -->
          </div><!--  weather column -->
        </div> <!-- row galleryCarousel -->
      </div> <!-- row countryTitle -->
        <% end %>


         


      <div class="row">
        <div class="col-xs-12">
          <div role="tabpanel" class="countryTabs">
            <!-- Nav tabs -->
            <ul class="nav nav-tabs" role="tablist">
              <li role="presentation" class="active">
                <a href="#over-view" aria-controls="over-view" role="tab" data-toggle="tab">Info</a>
              </li>
              <% if @userstops.exclude?(current_user.id) %>
              <li role="presentation">
                <a href="#journal" aria-controls="journal" role="tab" data-toggle="tab">Journal</a>
              </li>
              <% end %> 
              <li role="presentation">
                <a href="#all-pictures" aria-controls="all-pictures" role="tab" data-toggle="tab" onclick="showPhotos()">all pictures</a>
              </li>
              <li>
                <a href="/trips/<%=@trip.id%>">Back to Trip</a>
              </li>
              <% @userstops.each do |usertrip| %>
              <% if usertrip == current_user.id %>
              <li role="presentation" class="dropdown col-md-1 col-lg-1 col-sm-1">
                <button class="btn buttonTransparent dropdown-toggle editbutton" type="button" id="menu1" data-toggle="dropdown">Edit tools
                <span class="caret"></span></button>
                <ul class="dropdown-menu" role="menu" aria-labelledby="menu1">
                  <li role="presentation"><a role="menuitem" tabindex="-1" href="#add-pic" aria-controls="add-pic" role="tab" data-toggle="tab">Add a Picture</a></li>
                  <li role="presentation">
                  <a role="menuitem" tabindex="-1" href="#journal" aria-controls="journal" role="tab" data-toggle="tab"> Write in Journal </a>
                  </li>
                  <li role="presentation"><a role="menuitem" tabindex="-1" href="#add-travelers" aria-controls="add-travelers" role="tab" data-toggle="tab">Add Tr@\/e|ers</a></li>
                  <li role="presentation"><a role="menuitem" tabindex="-1" href="#edit-trip" aria-controls="edit-trip" role="tab" data-toggle="tab">Edit Trip</a></li>
                  <li role="presentation"><a role="menuitem" tabindex="-1"  aria-controls="tour-guide" role="tab" data-toggle="tab"> 
                  <% if @stop.archived == false || @stop.archived == nil %>
                  <%= link_to 'Archive Stop', "/stops/#{@stop.id}/archive", role: "tab", method: :patch %></a>
                  <% end %>
                  <% if @stop.archived == true %>
                  <%= link_to 'UnArchive Trip', "/stops/#{@stop.id}/unarchive", role: "tab", method: :patch %></a>
                  <% end %>
                </ul>
              </li>
              <% end %>
              <% end %>
              <li class="pull-right">

              </li>
            </ul>
          </div>
        </div>
      </div>



    <!-- Tab panes -->
      <div class="tab-content">

        <div role="tabpanel" class="tab-pane active" id="over-view">
          <div class="row">
            <div class="col-sm-8 col-xs-12">
              <div class="commonInfo">
                <h2><%= @stop.tagline %></h2>
                <p><%= @stop.description %></p>
              </div>
            </div>
          </div>
        </div>

        <div role="tabpanel" class="tab-pane" id="tour-guide">
          <div class="row">
            <div class="col-sm-8 col-xs-12">
              <div class="commonInfo">
                <h2>text</h2>
                <p>text</p>
                <ul class="list-inline">
                  <li><i class="fa fa-square" aria-hidden="true"></i> text </li>
                </ul>
              </div>
            </div>
          </div>
        </div>


        <div role="tabpanel" class="tab-pane" id="journal">
                  <div class="row">
                    <div class="col-sm-8 col-xs-12">
                      <div class="commonInfo">
                        <div class="container">
                          <div class="commentsArea">
                           
                              <% if @userstops.include?(current_user.id) %>
                              <h1>Make a journal entry!</h1>
                              <div>
                                <%= form_tag "/stops/#{@stop.id}/journal", method: :post do %>
                                <div class="form-group comments">
                                  <%= text_area_tag :entry, nil, placeholder: "How's your trip going??", class: "form-control" %>
                                </div>
                                <%= hidden_field_tag :user_id, current_user.id %>
                                <%= hidden_field_tag :blogable_type, "Stop" %>
                                <%= hidden_field_tag :blogable_id, @stop.id %>
                                <%= submit_tag  "Submit", class: "btn buttonTransparent editbutton" %> 
                                <% end %>
                              </div>          
                              <br>
                              <br>
                              <% else %>
                              <h4> Sorry! No Journal entries have been made yet. </h4>
                              <% end %>
                           

                            <% @blogentries.each do |blog| %>
                            <%#if this_comment.commentable_type == "Trip" %>
                            <div class="media">
                              <a class="media-left" href="#">
                                <img class="media-object comment_pic" src="/img/earth.png" alt="Image"></a>
                                <div class="media-body blog">
                                  <h4 class="media-heading">
                                    <%= blog.user.first_name %> <%= blog.user.last_name %></h4>
                                    <h4><span><i class="fa fa-calendar" aria-hidden="true"></i>Mar 20, 2016</span></h4>
                                    <p> <%= blog.entry %> </p>
                                    <button class="btn btn-link" type="button">Reply</button>
                                    <% if current_user.id == blog.user.id %>
                                    <%= link_to 'Delete', "/journals/#{blog.id}", method: :get %>
                                    <% end %>
                                    <br>
                                    <br>
                                  </div>
                                  <br>
                                  <%# end %>
                                </div>
                                <% end %>



                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>



        <div role="tabpanel" class="tab-pane" id="all-pictures">
          <!-- WHITE SECTION FILTER-->
          <div class="container">
            <div class="row">
              <div class="col-xs-12">
                <div class="filter-container isotopeFilters">
                  <ul class="list-inline filter">
                    <li class="active" style="display: none;"><a id="allpicbutton" href="#" data-filter="*">all pics</a></li>
                  </ul>
                </div>
              </div>
            </div>
          </div> <!-- container -->
          <div class="container">
            <div class="row isotopeContainer" id="container">
              <% @stop.images.each do |image| %>
              <div class="col-sm-3 isotopeSelector">
                <article class="">
                  <figure>
                    <img src="<%=image.url%>" alt="">
                    <h4><%=%></h4>
                    <div class="overlay-background">
                      <div class="inner"></div>
                    </div>
                    <div class="overlay">
                      <a class="fancybox-pop" rel="portfolio-1" href="<%=image.url%>">
                        <span class="overlayInfo overflow_hidden">
                          <p><%=image.description%></p>
                          <p><i class="fa fa-calendar" aria-hidden="true"></i>27 jan, 2016</p>
                        </span>
                      </a>
                    </div>
                  </figure>
                </article>
              </div> <!-- isotope selector -->
              <%end%>   
            </div> <!-- isoptope container -->
          </div> <!-- container -->
        </div> <!-- tab panel -->
      </div> <!-- tab content-->




      <% if @trip.stops.length > 1 %>
      <div class="row">
        <div class="col-xs-12">
          <div class="relatedProduct margin">
            <h2>Other Stops on this Trip:</h2>
              <% @trip.stops.each do |stop| %>
                <% if stop != @stop %>
                  <div class="col-sm-4 col-xs-12">
                    <div class="relatedItem">
                      <% if stop.images.length > 0 %>
                        <%= image_tag stop.images.first.url %>
                      <% else %>
                        <img src="/img/earth.png">
                      <% end %>
                        <div class="maskingInfo">
                          <h4><%=stop.name%></h4>
                          <p><%=stop.tagline%></p>
                          <a href="/stops/<%=stop.id%>" class="btn buttonTransparent">view more</a>
                        </div>
                      <% end %>
                    </div>
                  </div>
                <% end %>
              <% end %>
          </div> <!-- relatedproduct -->
        </div> <!-- col -->
      </div> <!-- row -->

      <div class="container">
        <div class="commentsArea">
          <br>
          <br>
          <br>
          <br>
          <br>

          <% @comments.each do |this_comment| %>
          <%#if this_comment.commentable_type == "Trip" %>
          <div class="media">
            <a class="media-left" href="#">
              <img class="media-object comment_pic" src="/img/earth.png" alt="Image">
            </a>
            <div class="media-body">
              <h4 class="media-heading">
                <%= this_comment.user.first_name %> <%= this_comment.user.last_name %>
              </h4>
              <h4><span><i class="fa fa-calendar" aria-hidden="true"></i>Mar 20, 2016</span>
              </h4>
              <p> <%= this_comment.comment %> </p>
              <button class="btn btn-link" type="button">Reply</button>
              <% if current_user.id == this_comment.user.id %>
              <%= link_to 'Delete', "/stops/comments/#{this_comment.id}", method: :delete %>
              <% end %>
              <br>
              <br>
            </div> <!-- media-body -->
              <%# end %>
          <% end %>
          </div> <!-- media  actally looks better without- todo: close gap with margins-->
          <div class="media">
            <a class="media-left" href="#">
              <img class="media-object leave_comment_pic" src="/img/earth.png" alt="Image">
            </a>

            <% if current_user %>   
            <h1>Leave a comment!</h1>
            <div>
              <%= form_tag "/stops/#{@stop.id}/comments", method: :post do %>
              <div class="form-group comments">
                <%= text_area_tag :comment, nil, placeholder: "Leave a comment!", class: "form-control" %>
              </div>
              <%= hidden_field_tag :user_id, current_user.id %>
              <%= hidden_field_tag :commentable_type, "Stop" %>
              <%= hidden_field_tag :commentable_id, @stop.id %>
              <%= submit_tag  "Submit", class: "btn buttonTransparent editbutton" %> 
              <% end %>
            </div>          

            <% end %>
            <% if !current_user %>
            <h3> Sign in to leave a comment! </h3>
              <a target="_blank" href="/users/auth/facebook" class="FBLI">    Sign in with Facebook</a>
            <%end%>
          </div> <!-- media -->
        </div> <!-- comments area -->
      </div> <!-- commentcontainer -->
    </div> <!-- container -->
  </section> <!-- mainContentSection singlePackage -->
</div> <!-- main container -->
      

  <script type="text/javascript"> 
    function showPhotos() {
      console.log("clicked");
      setTimeout(
        function() 
        {
          $( "#allpicbutton" ).click()          
        }, 1);
    }
  </script>

  <script>
    function initMap() {
      var firstMarker = {lat: <%= @stop.latitude %>, lng: <%= @stop.longitude %>};
      var map = new google.maps.Map(document.getElementById('map'), {
        zoom: 4,
        center: firstMarker
      });
      var marker = new google.maps.Marker({
        position: firstMarker,
        map: map
      });
    }
  </script>
  <script async defer
  src="https://maps.googleapis.com/maps/api/js?key=<%= "#{ENV['MAPS_API']}" %>&callback=initMap">
  </script>

